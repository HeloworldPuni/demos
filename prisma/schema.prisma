generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model User {
  id            String   @id @default(uuid())
  walletAddress String   @unique
  farcasterId   String?  @unique
  createdAt     DateTime @default(now())

  // Referral System
  referralPointsTotal      Float @default(0)
  referralRewardsClaimable Float @default(0)
  referralRewardsClaimed   Float @default(0)

  invites   Invite[]
  referrals Referral[] @relation("Referrer")
  referred  Referral?  @relation("Referee")
}

model Invite {
  id        String   @id @default(uuid())
  code      String   @unique
  creatorId String?
  creator   User?    @relation(fields: [creatorId], references: [id])
  status    String   @default("unused") // unused, used
  type      String   @default("standard") // founder, standard
  maxUses   Int      @default(1)
  usedCount Int      @default(0)
  createdAt DateTime @default(now())
  
  referral Referral?
}

model Referral {
  id         String   @id @default(uuid())
  referrerId String
  referrer   User     @relation("Referrer", fields: [referrerId], references: [id])
  refereeId  String   @unique
  referee    User     @relation("Referee", fields: [refereeId], references: [id])
  inviteId   String   @unique
  invite     Invite   @relation(fields: [inviteId], references: [id])
  joinedAt   DateTime @default(now())

  // Tracking Metrics
  totalFeesPaidByReferee        Float @default(0)
  totalProfitShareEarnedByReferee Float @default(0)
  referralPoints                Float @default(0)
  isRewardable                  Boolean @default(true)
}
